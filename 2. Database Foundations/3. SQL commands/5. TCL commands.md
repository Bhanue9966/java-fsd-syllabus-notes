## üõ†Ô∏è Transaction Control Language (TCL) Commands 

Transaction Control Language (TCL) commands are used to manage the changes made by DML commands (`INSERT`, `UPDATE`, `DELETE`). They are essential for maintaining the consistency and integrity of the data in the database, particularly in concurrent, multi-user environments. TCL ensures that a series of DML operations either succeed entirely or fail entirely (the "Atomic" and "Consistent" properties of ACID).

![Transaction lifecycle](<../SQL images/Transaction lifecycle.jpg>)

-----

### 1\. COMMIT Command

The `COMMIT` command makes all changes performed by DML statements permanent in the database. Once committed, the data changes cannot be reversed by `ROLLBACK`.

#### A. Basic Syntax

```sql
-- Syntax
COMMIT;

-- Example: Making all recent changes (INSERTs, UPDATEs, DELETEs) permanent
-- Start Transaction (often automatic)
UPDATE Accounts SET balance = balance - 100 WHERE account_id = 123;
UPDATE Accounts SET balance = balance + 100 WHERE account_id = 456;
-- End Transaction
COMMIT;
```

-----

### 2\. ROLLBACK Command

The `ROLLBACK` command is used to undo all changes made by DML statements since the last `COMMIT` or `ROLLBACK`. This restores the database to its state prior to the transaction's start.

#### A. Basic Syntax

```sql
-- Syntax (Undoing the entire current transaction)
ROLLBACK;

-- Example: Undoing unwanted changes due to an error
-- Start Transaction
INSERT INTO LogHistory (event) VALUES ('Attempted large data import');
DELETE FROM TempData WHERE process_id = 10;
-- A check reveals an issue, the entire operation is cancelled
ROLLBACK;
-- The database returns to the state before the INSERT and DELETE commands.
```

-----

### 3\. SAVEPOINT Command

The `SAVEPOINT` command is used to set a temporary marker within a transaction. This allows for partial rollbacks, meaning you can undo changes only up to a specific savepoint without affecting the earlier part of the transaction.

#### A. Setting a Savepoint

```sql
-- Syntax
SAVEPOINT savepoint_name;

-- Example: Defining a checkpoint after a safe operation
-- Start Transaction
UPDATE Inventory SET stock = stock - 10 WHERE item_id = 50;
SAVEPOINT inventory_update_1;
```

#### B. Rolling Back to a Savepoint

```sql
-- Syntax (Rolling back only to a specific marker)
ROLLBACK TO savepoint_name;

-- Example: Undoing the second batch of changes only
UPDATE Inventory SET stock = stock - 5 WHERE item_id = 60; -- Operation B
SAVEPOINT inventory_update_2;

-- ... Further code (Operation C)
INSERT INTO AuditLog (log_details) VALUES ('Failed operation');

-- Operation C failed, but Operation A and B are correct. Rollback to B.
ROLLBACK TO inventory_update_2;

-- Commit the remaining changes (Operation A and B)
COMMIT;
```

-----

### 4\. Transaction Modes and Control

In many SQL systems, explicit transaction control may involve setting the transaction mode or using explicit commands to start a transaction.

#### A. Setting Transaction Isolation Level

Defines how the transaction interacts with other concurrent transactions (e.g., controlling phenomena like dirty reads, non-repeatable reads, and phantom reads).

```sql
-- Syntax (Different databases support different levels)
SET TRANSACTION ISOLATION LEVEL level_name;

-- Common Isolation Levels (ordered from least restrictive to most restrictive):
-- 1. READ UNCOMMITTED (Allows "dirty reads")
-- 2. READ COMMITTED (Default for many systems like PostgreSQL, Oracle)
-- 3. REPEATABLE READ (Default for MySQL)
-- 4. SERIALIZABLE (Highest isolation, ensures transaction results are the same as if they ran sequentially)

-- Example: Set the highest isolation level for the current session
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
```

#### B. Starting an Explicit Transaction

While often automatic, some environments or operations require explicit transaction start commands.

```sql
-- Syntax (Standard SQL)
START TRANSACTION;

-- Syntax (Equivalent in MySQL/MariaDB)
BEGIN;

-- Syntax (Equivalent in SQL Server/T-SQL)
BEGIN TRANSACTION;
```