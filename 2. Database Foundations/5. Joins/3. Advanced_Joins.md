## ðŸ”— Specialized and Advanced Joins (01\_database\_foundations/02\_setup\_basics/14\_advanced\_joins.md)

Beyond the standard `INNER` and `OUTER` joins, SQL offers several specialized join types for handling complex data relationships, such as hierarchical structures or non-exact comparisons.

![SQL joins](<../SQL images/SQL joins.jpg>)

-----

### 1\. SELF JOIN

A **Self Join** is simply an `INNER` or `OUTER` join where a table is joined to **itself**. This is necessary when the data needed for the join condition and the data needed for the result set are both stored in different columns of the same table.

#### A. Key Requirement: Table Aliases

When performing a self-join, you must treat the single physical table as two separate logical tables in the query. This requires using **two distinct aliases** for the same table.

#### B. Use Case: Hierarchical Data

The most common use case is querying hierarchical data, such as an organizational chart where both the employee and their manager are listed in the same `Employees` table (linked by `manager_id` to `emp_id`).

```sql
-- Example: Finding each employee and their manager's name
SELECT
    E.first_name AS Employee,
    M.first_name AS Manager
FROM
    Employees AS E  -- The table representing the Employee
INNER JOIN
    Employees AS M  -- The table representing the Manager
ON
    E.manager_id = M.emp_id;
```

-----

### 2\. CROSS JOIN

The **Cross Join** (or Cartesian Join) combines every row of the first table with every row of the second table, resulting in a **Cartesian Product**.

  * **Principle:** If Table A has $N$ rows and Table B has $M$ rows, the result set will have $N \times M$ rows.
  * **Warning:** This type of join can produce an enormous result set and should be used with caution, as it lacks a join condition (`ON` clause).
  * **Use Case:** Generating all possible combinations between two sets of data (e.g., all color options for all shirt sizes).

<!-- end list -->

```sql
-- Syntax 1: Using the CROSS JOIN keyword (ANSI standard)
SELECT
    S.size_name,
    C.color_name
FROM
    Sizes AS S
CROSS JOIN
    Colors AS C;

-- Syntax 2: Listing tables in FROM clause without a WHERE or ON clause
SELECT
    S.size_name,
    C.color_name
FROM
    Sizes S, Colors C;
```

-----

### 3\. Non-Equi Joins

A **Non-Equi Join** is any join that uses a comparison operator other than equality (`=`) in the `ON` clause. This allows you to join tables based on ranges, overlaps, or inequalities.

#### A. Operators Used

The join condition in the `ON` clause can use operators such as:

  * **Inequalities:** $`>`$, $`<`$, $`!=`$
  * **Ranges:** `BETWEEN`

#### B. Use Case: Range Checking

A common scenario is to look up data that falls within a defined range, such as determining the tax rate based on an income bracket.

```sql
-- Example: Find the tax rate for each employee based on their salary
SELECT
    E.first_name,
    E.salary,
    T.rate
FROM
    Employees AS E
INNER JOIN
    TaxBrackets AS T
ON
    E.salary BETWEEN T.min_salary AND T.max_salary; -- Non-Equi condition
```

-----

### 4\. NATURAL JOIN (Discouraged)

The `NATURAL JOIN` automatically joins two tables based on all columns that share the **exact same name** and data type.

  * **Principle:** The database implicitly generates the join condition.
  * **Drawback:** It is dangerous because if the tables are altered and a new column is added with the same name, the join condition silently changes, potentially returning incorrect results. It is best to use explicit `INNER JOIN` with the `ON` or `USING` clause.

<!-- end list -->

```sql
-- Example (Avoid using this in production code)
SELECT
    first_name,
    dept_name
FROM
    Employees
NATURAL JOIN
    Departments; -- Automatically joins on the shared column 'dept_id'
```
