## ðŸ“ PL/SQL Fundamentals

**PL/SQL (Procedural Language/SQL)** is Oracle's procedural extension to SQL. It combines the data manipulation power of SQL with the procedural capabilities of languages like IF-THEN-ELSE statements, loops, and variables, allowing you to write complex application logic directly within the database.

-----

### 1\. The Basic PL/SQL Block Structure

All PL/SQL code is executed within a **block structure**. Blocks can be anonymous (executed immediately and not saved) or named (stored procedures, functions, or triggers).

#### A. Block Structure Components

A PL/SQL block consists of four main sections, with only the **`BEGIN`** and **`END`** sections being mandatory.

| Section | Keyword | Status | Purpose |
| :--- | :--- | :--- | :--- |
| **Declarative** | `DECLARE` | Optional | Defines all variables, cursors, and user-defined exceptions used within the block. |
| **Executable** | `BEGIN` | Mandatory | Contains the procedural logic and SQL statements. |
| **Exception Handling**| `EXCEPTION` | Optional | Defines actions to be taken when a runtime error occurs. |
| **Termination** | `END;` | Mandatory | Marks the end of the executable and exception sections. |

```sql
-- Anonymous Block Syntax
DECLARE
    -- Variable declarations (optional)
BEGIN
    -- Procedural and SQL statements (mandatory)
EXCEPTION
    -- Error handling statements (optional)
END;
/
```

> **Note:** The forward slash (`/`) on a new line is commonly used in Oracle SQL Developer or SQL\*Plus to execute the preceding anonymous block.

-----

### 2\. Variables and Data Types

Variables are declared in the **`DECLARE`** section and assigned values in the **`BEGIN`** section.

#### A. Standard Variable Declaration

Variables use standard SQL data types but must be given a size or precision where appropriate.

```sql
DECLARE
    v_employee_count    NUMBER(5);
    v_last_name         VARCHAR2(50) NOT NULL := 'Smith'; -- Initialized
    v_hire_date         DATE := SYSDATE;
    c_tax_rate          CONSTANT NUMBER(3, 2) := 0.15;    -- Constant variable
BEGIN
    v_employee_count := 10;
    DBMS_OUTPUT.PUT_LINE('Employee Count: ' || v_employee_count);
END;
/
```

#### B. Anchored Declarations (`%TYPE`)

The **`%TYPE`** attribute is used to declare a variable that adopts the data type and size of a specific database column or another previously declared variable.

  * **Benefit:** If the underlying table column's data type or size changes, the PL/SQL code does not need to be updated, reducing maintenance and preventing errors.

<!-- end list -->

```sql
DECLARE
    -- Variable adopts the data type and size of the Employees.salary column
    v_emp_salary    Employees.salary%TYPE;

    -- Variable adopts the data type and size of the v_emp_salary variable
    v_new_salary    v_emp_salary%TYPE;
BEGIN
    -- ...
    NULL;
END;
/
```

#### C. Record Variables (`%ROWTYPE`)

The **`%ROWTYPE`** attribute is used to declare a record variable that can hold an **entire row** fetched from a specified table or view. It creates a composite variable with fields corresponding to the table's columns.

```sql
DECLARE
    -- Declares a record that holds a full row of the Employees table
    r_employee_rec    Employees%ROWTYPE;
BEGIN
    -- SQL statement that retrieves a full row into the record variable
    SELECT
        *
    INTO
        r_employee_rec -- Row data is mapped to the record's fields (e.g., r_employee_rec.first_name)
    FROM
        Employees
    WHERE
        emp_id = 100;

    DBMS_OUTPUT.PUT_LINE('Employee: ' || r_employee_rec.first_name || ' ' || r_employee_rec.last_name);
END;
/
```

-----

### 3\. Executing SQL in PL/SQL

PL/SQL allows you to execute DML statements directly, but DQL (`SELECT`) requires a specific construct to handle the result set.

#### A. DML Statements

DML statements (`INSERT`, `UPDATE`, `DELETE`) are executed directly within the `BEGIN` block.

```sql
BEGIN
    -- Directly update a table
    UPDATE
        Employees
    SET
        salary = salary * 1.05
    WHERE
        dept_id = 20;

    -- Transaction control is manual in PL/SQL
    COMMIT;
END;
/
```

#### B. Querying Data (`SELECT INTO`)

The standard `SELECT` statement must include an **`INTO`** clause when executed in PL/SQL. The query must return **exactly one row**; otherwise, a runtime exception occurs.

```sql
DECLARE
    v_emp_name    Employees.first_name%TYPE;
    v_emp_salary  Employees.salary%TYPE;
BEGIN
    -- Selects two columns and maps them directly to two scalar variables
    SELECT
        first_name,
        salary
    INTO
        v_emp_name,
        v_emp_salary
    FROM
        Employees
    WHERE
        emp_id = 101;

    -- If the WHERE clause matched 0 or >1 row, an exception would be raised.
    DBMS_OUTPUT.PUT_LINE('Salary for ' || v_emp_name || ' is ' || v_emp_salary);
END;
/
```

  * **Resulting Exceptions:**
      * **`NO_DATA_FOUND`**: If the query returns zero rows.
      * **`TOO_MANY_ROWS`**: If the query returns more than one row. (These are covered in the Error Handling section.)

<!-- end list -->
