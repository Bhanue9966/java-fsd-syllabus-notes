## ⚙️ SQL Clauses and Functions 

This section details the primary clauses and functions used in SQL to retrieve, filter, group, and manipulate data. Understanding these components is key to writing effective and optimized SQL queries.

-----

### 1\. The Logical Order of Query Execution

Although a SQL query is written in a specific order (e.g., `SELECT` then `FROM`), the database engine executes the clauses in a fixed, **logical order**. Understanding this order is vital for correctly using clauses like `WHERE`, `GROUP BY`, and `HAVING`.

1.  **`FROM`**: Determines the source table(s) and performs **JOINs**.
2.  **`WHERE`**: Filters individual **rows** based on the specified condition. (Aliases created in `SELECT` are **not** yet available here).
3.  **`GROUP BY`**: Groups the filtered rows into summary rows.
4.  **`HAVING`**: Filters the **groups** created by `GROUP BY`.
5.  **`SELECT`**: Determines which columns/expressions are output. (Calculations and aliases are now assigned).
6.  **`ORDER BY`**: Sorts the final result set.
7.  **`LIMIT`/`FETCH`**: Restricts the number of rows returned.

-----

### 2\. Essential Clauses

Clauses are structural components of the `SELECT` statement that perform specific tasks.

#### A. `FROM` and `JOIN`

Specifies the tables involved in the query and how they are related.

```sql
-- Joining two tables (Employees and Departments)
SELECT E.first_name, D.dept_name
FROM Employees AS E
INNER JOIN Departments AS D
  ON E.dept_id = D.dept_id;
```

#### B. `WHERE`

Filters individual records **before** any grouping or aggregation occurs.

```sql
-- Filtering records before aggregation
SELECT product_name, price
FROM Products
WHERE price > 100.00 AND category_id IN (1, 5);
```

#### C. `GROUP BY`

Groups rows with identical values in the specified column(s) into a summary row, enabling the use of **aggregate functions**.

```sql
-- Grouping records by department ID
SELECT dept_id, COUNT(*) AS Employee_Count
FROM Employees
GROUP BY dept_id;
```

#### D. `HAVING`

Filters the results of a `GROUP BY` query. It operates on the output of aggregate functions, which is not possible with the `WHERE` clause.

```sql
-- Filtering groups: Show only departments with more than 5 employees
SELECT dept_id, COUNT(*) AS Employee_Count
FROM Employees
GROUP BY dept_id
HAVING COUNT(*) > 5;
```

#### E. `ORDER BY`

Sorts the final result set in ascending (`ASC`) or descending (`DESC`) order.

```sql
-- Sorting by multiple criteria
SELECT first_name, last_name, hire_date
FROM Employees
ORDER BY hire_date ASC, last_name DESC;
```

#### F. `LIMIT` / `FETCH` / `TOP`

Used to restrict the number of rows returned by the query.

```sql
-- MySQL/PostgreSQL Syntax (LIMIT)
SELECT product_name, price
FROM Products
ORDER BY price DESC
LIMIT 10;

-- SQL Server Syntax (TOP)
SELECT TOP 10 product_name, price
FROM Products
ORDER BY price DESC;
```

-----

### 3\. SQL Functions

SQL functions are built-in features that perform calculations, manipulate data, or return information about the database environment.

#### A. Aggregate Functions

These functions operate on a set of rows and return a **single summary value**. They are typically used with the `GROUP BY` clause.

| Function | Description | Example |
| :--- | :--- | :--- |
| `COUNT()` | Returns the number of rows. | `COUNT(*)` or `COUNT(column)` |
| `SUM()` | Calculates the sum of values in a numeric column. | `SUM(order_total)` |
| `AVG()` | Calculates the average of values in a numeric column. | `AVG(salary)` |
| `MIN()` | Returns the smallest value in a column. | `MIN(hire_date)` |
| `MAX()` | Returns the largest value in a column. | `MAX(sales_amount)` |

```sql
-- Example using aggregate functions
SELECT
    AVG(salary) AS Average_Salary,
    MAX(salary) AS Highest_Salary,
    MIN(salary) AS Lowest_Salary
FROM Employees
WHERE dept_id = 101;
```

#### B. Scalar (Single-Row) Functions

These functions operate on a single input value (a column or expression) and return a single output value for each row.

##### i. String Functions

Used for manipulating character data.

| Function | Description | Example (PostgreSQL/Oracle/SQL Server) |
| :--- | :--- | :--- |
| `CONCAT()` | Joins two or more strings. | `CONCAT(first_name, ' ', last_name)` |
| `SUBSTR()` / `SUBSTRING()` | Extracts a substring from a string. | `SUBSTR(product_code, 1, 3)` |
| `LOWER()` / `UPPER()` | Converts string to lowercase/uppercase. | `UPPER(dept_name)` |
| `LENGTH()` | Returns the number of characters in a string. | `LENGTH(address)` |

```sql
-- Example: Using string functions
SELECT
    product_name,
    UPPER(product_name) AS Name_UpperCase,
    LENGTH(product_name) AS Name_Length
FROM Products;
```

##### ii. Numeric Functions

Used for mathematical operations.

| Function | Description | Example |
| :--- | :--- | :--- |
| `ROUND()` | Rounds a number to a specified number of decimal places. | `ROUND(price, 2)` |
| `TRUNC()` / `TRUNCATE()` | Truncates a number (removes decimals). | `TRUNC(amount, 0)` |
| `MOD()` | Returns the remainder of a division operation. | `MOD(id, 2)` |
| `POWER()` | Returns the value of a number raised to the power of another number. | `POWER(2, 3)` |

```sql
-- Example: Using numeric functions
SELECT
    original_value,
    ROUND(original_value, 1) AS Rounded_Value
FROM Calculations;
```

##### iii. Date and Time Functions

Used for manipulating and retrieving temporal data (syntax heavily varies by vendor).

| Function | Description | Example (General Concept) |
| :--- | :--- | :--- |
| `CURRENT_DATE()` | Returns the current date. | `hire_date > CURRENT_DATE()` |
| `DATEDIFF()` / `DATE_DIFF()` | Calculates the difference between two dates. | `DATEDIFF(day, hire_date, CURRENT_DATE())` |
| `DATE_ADD()` / `DATEADD()` | Adds a time interval to a date. | `DATE_ADD(order_date, INTERVAL 30 DAY)` |
| `EXTRACT()` | Retrieves a specific part (e.g., year, month) from a date. | `EXTRACT(YEAR FROM hire_date)` |

```sql
-- Example: Calculating tenure (MySQL syntax)
SELECT
    first_name,
    DATEDIFF(CURRENT_DATE(), hire_date) / 365 AS Tenure_Years
FROM Employees;
```

#### C. Flow Control Functions (Conditional Logic)

These functions allow for conditional logic within the `SELECT` statement itself.

##### i. `CASE` Expression

The `CASE` expression is a powerful tool for implementing `IF-THEN-ELSE` logic in SQL.

```sql
-- Syntax
CASE
    WHEN condition1 THEN result1
    WHEN condition2 THEN result2
    ...
    ELSE result_n
END AS column_alias;

-- Example: Categorizing employee salary level
SELECT
    last_name,
    salary,
    CASE
        WHEN salary > 80000 THEN 'High Earner'
        WHEN salary >= 50000 THEN 'Mid-Range'
        ELSE 'Junior'
    END AS Salary_Band
FROM Employees;
```

##### ii. `COALESCE()`

Returns the first **non-null** expression in a list of expressions. Useful for substituting a default value when a column might be null.

```sql
-- Example: Display 'N/A' if the 'phone_number' is NULL
SELECT
    first_name,
    COALESCE(phone_number, 'N/A') AS Contact_Number
FROM Employees;
```