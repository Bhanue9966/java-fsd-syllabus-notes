This is an important module. **Hibernate Query Language (HQL)** is how you interact with your data in an object-oriented way, rather than writing raw SQL.

I will provide the detailed explanation in the notes file and the complete, runnable Java code demonstrating various HQL operations.

-----

# üóÑÔ∏è Persistence and ORM

## 11\. Hibernate Query Language (HQL)

### 1\. What is HQL? ‚ùì

Hibernate Query Language (HQL) is an **object-oriented query language** designed to work directly with Java objects and properties rather than tables and columns. It is syntactically very similar to SQL, but it operates at the mapping layer.

#### Key Characteristics:

  * **Case-Sensitivity:** HQL keywords (like `SELECT`, `FROM`, `WHERE`) are case-insensitive, but class and property names (like `Student`, `rollNo`) are **case-sensitive** because they refer to Java identifiers.
  * **Database Independent:** Since HQL works with entity objects, it is portable across different database types. Hibernate translates the HQL into the appropriate dialect of SQL (e.g., PostgreSQL, MySQL).
  * **Root of Query:** All HQL queries start by referencing a class name, not a table name (e.g., `FROM Student` instead of `FROM student_table`).

### 2\. Basic HQL Operations

HQL queries are executed using the `Session.createQuery()` method, which returns a `Query` object.

#### A. Selecting All Entities

```hql
FROM Student
```

  * **Purpose:** Retrieves all records from the `Student` table and returns a list of `Student` objects.

#### B. Selecting Specific Fields (Projection)

```hql
SELECT rollNo, sName FROM Student
```

  * **Purpose:** Retrieves only the specified properties. This returns a `List<Object[]>` or `List<Object>`, not a `List<Student>`, as only partial data is returned.

#### C. Using the WHERE Clause

The `WHERE` clause is used to filter results, similar to SQL.

```hql
FROM Student WHERE sAge > 25 AND sName = 'Navin'
```

#### D. Using Parameters (Security and Readability)

Using parameters is crucial for security (preventing SQL Injection) and better readability.

| Method | Syntax | Description |
| :--- | :--- | :--- |
| **Positional** | `FROM Student WHERE rollNo = ?1` | Use `?` followed by an index (starting at 0 or 1, depending on API version). |
| **Named** | `FROM Student WHERE rollNo = :rNo` | Recommended. Use `:` followed by a user-defined parameter name. |

### 3\. HQL for DML (Data Manipulation Language)

HQL can also be used for bulk `UPDATE` and `DELETE` operations, which are often faster than fetching objects, modifying them, and merging them back individually. **These operations require a transaction.**

  * **UPDATE:** `UPDATE Student SET sAge = 40 WHERE sName = 'Navin'`
  * **DELETE:** `DELETE FROM Student WHERE rollNo = 10`

-----

Here are the entity and the complete demonstration code:

```java
package com.telusko;

import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.Transaction;
import org.hibernate.cfg.Configuration;
import org.hibernate.query.Query;
import java.util.List;

public class HqlDemo {
    
    public static void main(String[] args) {

        SessionFactory sf = new Configuration()
                .configure()
                .addAnnotatedClass(Student.class)
                .buildSessionFactory();
        
        // --- SETUP: Ensure data exists ---
        try (Session session = sf.openSession()) {
             setupData(session);
        } catch (Exception e) {
             System.err.println("Setup failed: " + e.getMessage());
        }

        // ==================================================================
        // A. BASIC SELECT (Retrieve all objects)
        // ==================================================================
        System.out.println("\n--- A. Basic SELECT (HQL: FROM Student) ---");
        try (Session session = sf.openSession()) {
            // HQL uses the class name 'Student'
            Query<Student> query = session.createQuery("FROM Student", Student.class);
            List<Student> students = query.list();
            
            for(Student s : students) {
                System.out.println("-> " + s);
            }
        }
        
        // ==================================================================
        // B. SELECT WITH WHERE and NAMED PARAMETER
        // ==================================================================
        System.out.println("\n--- B. SELECT with WHERE and Named Parameter ---");
        try (Session session = sf.openSession()) {
            String hql = "FROM Student WHERE rollNo = :id";
            Query<Student> query = session.createQuery(hql, Student.class);
            
            // Set the named parameter
            query.setParameter("id", 101);
            
            Student s = query.uniqueResult();
            if (s != null) {
                System.out.println("Found student by rollNo 101: " + s);
            } else {
                System.out.println("Student with rollNo 101 not found.");
            }
        }

        // ==================================================================
        // C. SELECT for Specific Fields (Projection)
        // ==================================================================
        System.out.println("\n--- C. SELECT Specific Fields (Projection) ---");
        try (Session session = sf.openSession()) {
            // Query for partial data (rollNo and sName)
            Query<Object[]> query = session.createQuery("SELECT rollNo, sName FROM Student WHERE sAge > 25", Object[].class);
            List<Object[]> results = query.list();
            
            for(Object[] result : results) {
                System.out.println("RollNo: " + result[0] + ", Name: " + result[1]);
            }
        }

        // ==================================================================
        // D. DML: HQL UPDATE Operation
        // ==================================================================
        System.out.println("\n--- D. HQL UPDATE Operation ---");
        try (Session session = sf.openSession()) {
            Transaction tx = session.beginTransaction();
            
            String hqlUpdate = "UPDATE Student SET sAge = :newAge WHERE rollNo = :id";
            Query query = session.createQuery(hqlUpdate);
            query.setParameter("newAge", 45);
            query.setParameter("id", 102);
            
            int rowsAffected = query.executeUpdate();
            tx.commit();
            System.out.println("Rows updated (rollNo 102): " + rowsAffected);
            
            // Verify update
            Student s = session.find(Student.class, 102);
            System.out.println("Verified age for 102: " + s.getsAge());
        }

        if (sf != null) {
            sf.close();
            System.out.println("\nSessionFactory closed.");
        }
    }
    
    // Helper method to ensure the data exists for the demo
    private static void setupData(Session session) {
        Transaction tx = session.beginTransaction();
        
        session.merge(new Student(101, "Navin", 28));
        session.merge(new Student(102, "Telusko", 35));
        session.merge(new Student(103, "Kiran", 24));
        
        tx.commit();
        System.out.println("Sample data setup complete.");
    }
}
```