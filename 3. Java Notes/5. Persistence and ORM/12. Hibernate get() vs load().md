# üóÑÔ∏è Persistence and ORM

## 12. Hibernate `get()` vs. `load()`

The `Session` interface provides two methods, `get()` and `load()`, for retrieving an entity by its primary key (ID). Although they appear similar, their underlying mechanism and behavior are critically different and impact performance and stability.

### 1. `session.get(Class, ID)` üì¨

* **Behavior:** Eager loading.
* **Database Hit:** Executes a SQL `SELECT` query **immediately** upon being called.
* **Return Type (If Not Found):** Returns `null` if the record is not found in the database.
* **Proxy:** Does **not** use a proxy object. It returns the actual persistent entity object.
* **Use Case:** Use `get()` when you **must confirm** whether the record exists in the database immediately, or if you plan to access the object's data right away.

### 2. `session.load(Class, ID)` üëª

* **Behavior:** Lazy loading.
* **Database Hit:** Does **not** execute a SQL `SELECT` query immediately. It merely returns a **proxy** object (a ghost object) that contains the ID.
* **Return Type (If Not Found):** If the record does not exist, `load()` throws an **`ObjectNotFoundException`** (a runtime exception) only when you first try to access a non-ID property of the proxy.
* **Proxy:** Returns a proxy object. The actual database hit occurs only when a non-ID method (like `getName()`) is called on this proxy for the first time.
* **Use Case:** Use `load()` when you are certain the object exists and you only need to use the object reference (and possibly its ID) for a foreign key association, delaying the database load as long as possible.



### 3. Comparison Summary Table

| Feature | `get()` Method | `load()` Method |
| :--- | :--- | :--- |
| **Loading** | Eager | **Lazy** (uses a proxy) |
| **DB Access** | **Immediate** | Deferred (on first access of data) |
| **Missing ID** | Returns `null` | Throws **`ObjectNotFoundException`** (at access time) |
| **Type Returned**| Real Entity Object | **Proxy** (subclass of the entity) |

---

Here are the complete, runnable code files demonstrating the behavior:

```java
package com.telusko;

import org.hibernate.ObjectNotFoundException;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.Transaction;
import org.hibernate.cfg.Configuration;

/**
 * Demonstrates the behavior differences between session.get() and session.load().
 * NOTE: Watch the console output closely to see when the SELECT query is executed.
 */
public class GetLoadDemo {
    
    private static final int EXISTING_ID = 201;
    private static final int NON_EXISTING_ID = 999;

    public static void main(String[] args) {

        SessionFactory sf = new Configuration()
                .configure()
                .addAnnotatedClass(Student.class)
                .buildSessionFactory();
        
        // --- SETUP: Ensure one data point exists ---
        try (Session session = sf.openSession()) {
             setupData(session);
        } catch (Exception e) {
             System.err.println("Setup failed: " + e.getMessage());
        }

        // ==================================================================
        // DEMO 1: GET vs LOAD with an EXISTING ID
        // ==================================================================
        System.out.println("\n=============================================");
        System.out.println("DEMO 1: GET vs LOAD with an EXISTING ID (" + EXISTING_ID + ")");
        System.out.println("=============================================");
        
        try (Session session = sf.openSession()) {
            
            // --- A. GET() demonstration ---
            System.out.println("\n--- A. Calling session.get() ---");
            // DB SELECT query executes immediately here!
            Student studentGet = session.get(Student.class, EXISTING_ID); 
            System.out.println("GET called. Object class: " + studentGet.getClass().getSimpleName());
            System.out.println("Data accessed: " + studentGet.getsName()); // No second query needed
            
            // --- B. LOAD() demonstration ---
            System.out.println("\n--- B. Calling session.load() ---");
            // NO DB SELECT query executes here yet. A Proxy is returned.
            Student studentLoad = session.load(Student.class, EXISTING_ID);
            System.out.println("LOAD called. Object class: " + studentLoad.getClass().getSimpleName() + " (Note: This is a Proxy)");
            
            // The DB SELECT query executes NOW, when the data is accessed for the first time.
            System.out.println("Data accessed: " + studentLoad.getsName()); 
        } 
        
        
        // ==================================================================
        // DEMO 2: GET vs LOAD with a NON-EXISTING ID
        // ==================================================================
        System.out.println("\n=============================================");
        System.out.println("DEMO 2: GET vs LOAD with NON-EXISTING ID (" + NON_EXISTING_ID + ")");
        System.out.println("=============================================");
        
        try (Session session = sf.openSession()) {
            
            // --- A. GET() demonstration ---
            System.out.println("\n--- A. Calling session.get() ---");
            // DB SELECT query executes immediately. Returns null.
            Student studentGetNotFound = session.get(Student.class, NON_EXISTING_ID); 
            
            if (studentGetNotFound == null) {
                System.out.println("GET result: Returns null if not found. ‚úÖ Correct.");
            }
            
            // --- B. LOAD() demonstration ---
            System.out.println("\n--- B. Calling session.load() ---");
            // NO DB SELECT query executes here. A Proxy is returned.
            Student studentLoadNotFound = session.load(Student.class, NON_EXISTING_ID);
            System.out.println("LOAD called. Object class: " + studentLoadNotFound.getClass().getSimpleName() + " (Proxy created)");
            
            // The DB SELECT query executes NOW, which results in ObjectNotFoundException
            try {
                System.out.println("Attempting to access data on load() proxy...");
                studentLoadNotFound.getsName();
            } catch (ObjectNotFoundException e) {
                 System.out.println("LOAD result: Throws ObjectNotFoundException at access time. ‚úÖ Correct.");
            }
            
        } 
        
        if (sf != null) {
            sf.close();
            System.out.println("\nSessionFactory closed.");
        }
    }
    
    // Helper method to ensure the data exists for the demo
    private static void setupData(Session session) {
        Transaction tx = session.beginTransaction();
        
        session.merge(new Student(EXISTING_ID, "Priya", 32));
        
        tx.commit();
        System.out.println("Sample data setup complete (RollNo " + EXISTING_ID + ").");
    }
}
```