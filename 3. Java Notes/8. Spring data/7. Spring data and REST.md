# üíæ 8. Spring Data

## 07-spring-data-rest.md

### ü§ñ Introduction to Spring Data REST (SDR)

**Spring Data REST (SDR)** is a sub-project of Spring Data that automatically exposes a full **HATEOAS-compliant RESTful API** for your domain model. If you use `JpaRepository` (or other Spring Data repositories), SDR can generate all the necessary endpoints for basic **CRUD** operations without you writing a single **Controller** class.

#### Key Benefit: Zero Controller Code

SDR effectively eliminates the need for the Controller Layer (`@RestController`) for standard CRUD operations, allowing you to focus purely on the business logic in the Service Layer and the data structure in the Repository Layer.

### 1\. Setup and Activation

#### üìù Step 1: Add the Dependency

You must include the Spring Data REST starter in your build file.

**Maven (`pom.xml`)**

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-rest</artifactId>
</dependency>
```

#### üìù Step 2: Define the Repository (Already Done\!)

SDR works by scanning for interfaces that extend Spring Data's repository base interfaces (like `JpaRepository`). Since we already have the `ProductRepository` defined, no further code changes are needed in the repository itself.

**`ProductRepository.java`**

```java
public interface ProductRepository extends JpaRepository<Product, Long> {
    // ... all CRUD and custom query methods are now exposed via REST ...
}
```

### 2\. Generated API Endpoints (The Magic)

Once the application starts, SDR automatically detects the `ProductRepository` and exposes the following standard REST endpoints, typically rooted at a path derived from the entity name (e.g., `products`).

| Operation | HTTP Method | Endpoint (e.g., default port 8080) | Purpose |
| :--- | :--- | :--- | :--- |
| **Discover** | `GET` | `http://localhost:8080/api` | Entry point showing all exposed resources. |
| **Read All** | `GET` | `http://localhost:8080/api/products` | Fetch a list of all products (paginated). |
| **Read One** | `GET` | `http://localhost:8080/api/products/{id}` | Fetch a single product by its ID. |
| **Create** | `POST` | `http://localhost:8080/api/products` | Create a new product (sends JSON body). |
| **Update** | `PUT`/`PATCH` | `http://localhost:8080/api/products/{id}` | Update an existing product (PUT replaces, PATCH updates). |
| **Delete** | `DELETE` | `http://localhost:8080/api/products/{id}` | Delete a product by its ID. |

### 3\. HATEOAS and Self-Describing APIs

A core principle of SDR is adherence to **HATEOAS** (Hypermedia As The Engine Of Application State).

This means that every response returned by SDR contains **hyperlinks** (called "links") that guide the client on what actions are possible next.

#### Example: Response Body for a Single Product

If you make a `GET` request to `http://localhost:8080/api/products/1`:

```json
{
  "name": "Laptop Pro",
  "price": 1350.00,
  
  "_links": {
    "self": {
      "href": "http://localhost:8080/api/products/1"
    },
    "product": {
      "href": "http://localhost:8080/api/products/1"
    }
  }
}
```

  * The `_links` object shows the client how to retrieve the resource again (`self`) or navigate to related resources, making the API self-describing.

### 4\. Customizing the API Path

By default, SDR uses the pluralized form of the entity class name (`Product` $\rightarrow$ `products`). You can customize this path using the `@RepositoryRestResource` annotation on the repository interface.

**`ProductRepository.java` (Custom Path Example)**

```java
package com.example.repository;

import com.example.model.Product;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.rest.core.annotation.RepositoryRestResource;

@RepositoryRestResource(path = "catalogue") // The path will now be /api/catalogue
public interface ProductRepository extends JpaRepository<Product, Long> {
    // ...
}
```

Now, the endpoint for all products would be: `http://localhost:8080/api/catalogue`.

### 5\. Exposing Custom Search Methods

SDR automatically detects and exposes the custom query methods (like the ones using JPQL or query derivation) under a special `/search` path.

For example, the derived method `findByName(String name)` is automatically exposed as:

| Operation | HTTP Method | Endpoint | Example Usage |
| :--- | :--- | :--- | :--- |
| **Search** | `GET` | `http://localhost:8080/api/products/search/findByName` | `...?name=Laptop%20Pro` |

