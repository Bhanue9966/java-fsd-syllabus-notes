# ðŸ”— Collections, Exceptions, Concurrency

## 17\. Stream Operations (Intermediate and Terminal)

Stream operations are the heart of the Stream API, enabling complex, declarative data processing. They are categorized into **Intermediate Operations** (lazy and transformational) and **Terminal Operations** (eager and consumption-based).

### 1\. Intermediate Operations (Transformation and Filtering)

Intermediate operations are chained together to create a pipeline. They are **lazy**, meaning they only execute when a terminal operation is present.

| Operation | Purpose | Example | Result/Action |
| :--- | :--- | :--- | :--- |
| **`filter(Predicate)`** | Selects elements that match a given condition. | `.filter(s -> s.startsWith("A"))` | Returns a stream containing only "A" words. |
| **`map(Function)`** | **Transforms** each element into a new element (of potentially a different type). | `.map(User::getName)` | Transforms a stream of `User` objects into a stream of `String` names. |
| **`flatMap(Function)`** | **Flattens** a stream of collections (or arrays) into a single, unified stream. | `.flatMap(List::stream)` | Combines a `Stream<List<T>>` into a single `Stream<T>`. |
| **`distinct()`** | Removes duplicate elements based on the object's `equals()` method. | `.distinct()` | Returns a stream with only unique elements. |
| **`sorted(Comparator)`** | Sorts the stream elements using natural order or a custom `Comparator`. | `.sorted(Comparator.reverseOrder())` | Returns a sorted stream (descending order). |
| **`limit(n)`** | Truncates the stream to contain at most the first $n$ elements. | `.limit(5)` | Returns a stream of the first 5 elements. |
| **`skip(n)`** | Discards the first $n$ elements of the stream. | `.skip(5)` | Returns a stream starting from the 6th element. |
| **`peek(Consumer)`** | Performs an action on each element as they pass through the stream, primarily used for **debugging**. | `.peek(System.out::println)` | Executes the consumer but returns the same stream. |

#### Example: Transformation and Flattening with `flatMap`

```java
List<List<String>> namesByGroup = Arrays.asList(
    Arrays.asList("Alice", "Bob"),
    Arrays.asList("Charlie", "David")
);

// We want a single stream of all names.
namesByGroup.stream()
    .flatMap(List::stream) // Flattens the two inner lists into one stream
    .map(String::toUpperCase) // Intermediate: Transforms names to uppercase
    .forEach(System.out::println); 
    
/*
Output:
ALICE
BOB
CHARLIE
DAVID
*/
```

-----

### 2\. Terminal Operations (Consumption and Result)

Terminal operations consume the stream and trigger the execution of the entire pipeline. After a terminal operation is called, the stream is **closed** and cannot be reused.

#### A. Reduction Operations (Producing a single value)

| Operation | Purpose | Example | Result Type |
| :--- | :--- | :--- | :--- |
| **`reduce()`** | Combines elements into a single result using a combining function (accumulator). | `.reduce(0, Integer::sum)` | Returns an aggregate value (e.g., sum). |
| **`count()`** | Returns the number of elements in the stream. | `.count()` | `long` |
| **`max(Comparator)`** | Returns the largest element in the stream. | `.max(Integer::compare)` | `Optional<T>` |
| **`min(Comparator)`** | Returns the smallest element in the stream. | `.min(Integer::compare)` | `Optional<T>` |

#### B. Short-Circuiting Operations (May stop early)

| Operation | Purpose | Example | Result Type |
| :--- | :--- | :--- | :--- |
| **`anyMatch(Predicate)`** | Returns `true` if **at least one** element matches the predicate. | `.anyMatch(x -> x > 10)` | `boolean` (stops as soon as it finds a match) |
| **`allMatch(Predicate)`** | Returns `true` if **all** elements match the predicate. | `.allMatch(x -> x < 50)` | `boolean` (stops as soon as it finds a mismatch) |
| **`noneMatch(Predicate)`** | Returns `true` if **no** elements match the predicate. | `.noneMatch(String::isEmpty)` | `boolean` |
| **`findFirst()`** | Returns the first element in the stream, wrapped in an `Optional`. | `.findFirst()` | `Optional<T>` |

#### C. Collection Operations (Collecting results into a container)

| Operation | Purpose | Example | Result Type |
| :--- | :--- | :--- | :--- |
| **`collect(Collector)`** | The most flexible terminal operation; gathers elements into a new Collection or summarizes them. | `.collect(Collectors.toList())` | `List<T>` |
| **`toArray()`** | Stores the elements into an array. | `.toArray(String[]::new)` | `T[]` |
| **`forEach()`** | Performs an action for each element. | `.forEach(Consumer)` | `void` |

#### Example: Collecting to a Map and Summarizing

```java
import java.util.stream.Collectors;

List<String> words = Arrays.asList("apple", "banana", "ant", "ball");

// Grouping words by their first letter
Map<Character, List<String>> grouped = words.stream()
    .collect(Collectors.groupingBy(s -> s.charAt(0))); 
    
System.out.println(grouped); 
// Output: {a=[apple, ant], b=[banana, ball]}

// Simple reduction
int totalLength = words.stream()
    .mapToInt(String::length)
    .sum(); // Specialized terminal operation for primitive streams
    
System.out.println("Total Length: " + totalLength); // 21
```

