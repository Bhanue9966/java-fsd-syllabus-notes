# ðŸ”— Collections, Exceptions, Concurrency

## 19\. Optional Class

The **`java.util.Optional<T>`** class is a container object used to represent the presence or absence of a value. Introduced in Java 8, its primary purpose is to provide a type-level solution for representing an optional return value, thereby helping to eliminate the frequent and disruptive **`NullPointerException`** (NPE).

### 1\. The Problem: `NullPointerException` ðŸš«

In older Java code, methods often return `null` to indicate that a requested value could not be found (e.g., searching for a non-existent user). The caller must then perform an explicit `if (result != null)` check. Failing to perform this check leads to the infamous NPE.

**`Optional`** forces the developer to explicitly handle the case where the value is absent, making the code safer and more readable.

### 2\. Creating `Optional` Objects

You can create `Optional` instances using three main static methods:

| Method | Purpose | Example | State |
| :--- | :--- | :--- | :--- |
| **`Optional.of(T value)`** | Creates an `Optional` with the specified present, **non-null** value. | `Optional<String> name = Optional.of("Alice");` | **Present** |
| **`Optional.empty()`** | Creates an empty `Optional` instance with no value present. | `Optional<Integer> num = Optional.empty();` | **Absent** |
| **`Optional.ofNullable(T value)`** | Creates an `Optional` if the value is non-null; otherwise, returns an empty `Optional`. **(Safest creation method)** | `Optional<String> s = Optional.ofNullable(maybeNull);` | **Present or Absent** |

> âš ï¸ **Caution:** Do not use `Optional.of(null)`. It will immediately throw a `NullPointerException`.

### 3\. Handling Values Declaratively

The power of `Optional` lies in its methods that allow you to handle the absent case without explicit `if/else` checks, often chaining operations functionally.

#### A. Checking Presence

| Method | Description | Example |
| :--- | :--- | :--- |
| **`isPresent()`** | Returns `true` if a value is present, `false` otherwise. (Discouraged in favor of functional methods). | `if (opt.isPresent()) { ... }` |
| **`isEmpty()`** (Java 11+) | Returns `true` if no value is present. | `if (opt.isEmpty()) { ... }` |
| **`ifPresent(Consumer)`** | If a value is present, executes the given `Consumer` with the value. | `opt.ifPresent(System.out::println);` |

#### B. Returning Default Values (Fallback)

These methods provide a value when the `Optional` is empty:

| Method | Description | Example |
| :--- | :--- | :--- |
| **`orElse(T other)`** | Returns the value if present, otherwise returns the specified default value. | `String result = opt.orElse("Default Name");` |
| **`orElseGet(Supplier)`** | Returns the value if present, otherwise returns the value produced by the `Supplier` function. (Lazy evaluation: Supplier is only called if needed). | `String result = opt.orElseGet(() -> getDefault());` |
| **`orElseThrow()`** | Returns the value if present, otherwise throws a `NoSuchElementException` (or a custom exception if specified). | `String result = opt.orElseThrow();` |

#### C. Chaining Operations (Functional Style)

| Method | Description | Analogy to Streams |
| :--- | :--- | :--- |
| **`map(Function)`** | If a value is present, applies the mapping function to it, and returns a new `Optional` containing the result. If empty, returns empty. | Similar to `Stream.map()` |
| **`filter(Predicate)`** | If a value is present and matches the `Predicate`, returns the `Optional`; otherwise, returns empty. | Similar to `Stream.filter()` |

### 4\. Comprehensive Example

This demonstrates how `Optional` can eliminate NPEs and messy branching logic:

```java
import java.util.Optional;

public class OptionalDemo {
    // Simulates a database lookup that might fail
    public static Optional<String> findUserNameById(int id) {
        if (id == 101) {
            return Optional.of("Alice"); // Value is present
        }
        return Optional.empty(); // Value is absent
    }

    public static void main(String[] args) {
        // --- Case 1: Value is Present ---
        Optional<String> user1 = findUserNameById(101);

        user1.ifPresent(name -> System.out.println("User 1 found: " + name.toUpperCase()));
        // Output: User 1 found: ALICE

        // --- Case 2: Value is Absent ---
        Optional<String> user2 = findUserNameById(202);

        // Safe way to get a value or use a fallback
        String fallbackName = user2.orElse("GUEST"); 
        System.out.println("User 2 name: " + fallbackName); // Output: GUEST

        // --- Chaining Example ---
        int length = findUserNameById(101)
            .map(String::length) // Map the String to its length (Optional<Integer>)
            .filter(len -> len > 3) // Filter out short names
            .orElse(0); // If absent or filter failed, return 0

        System.out.println("Length: " + length); // Output: 5 ("Alice".length())
    }
}
```

