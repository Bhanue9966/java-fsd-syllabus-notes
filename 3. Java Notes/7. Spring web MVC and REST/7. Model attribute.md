# üåê 7. Spring Web MVC and REST

## 07-model-attribute.md

### üß© The `@ModelAttribute` Annotation

The `@ModelAttribute` annotation serves a dual purpose in Spring MVC Controllers:

1.  **Providing Data (Model Population):** It places an object into the **`Model`** container automatically, making it available to the View *before* the handler method executes.
2.  **Binding Data (Form Submission):** It binds incoming form data (from HTTP request parameters) to a Java object, preparing it for the handler method.

### 1\. Model Population (Class or Method Level)

When applied to a method, `@ModelAttribute` is executed **before** any request handler method in the same controller. Its return value is automatically added to the `Model`.

This is ideal for data required by *every* view rendered by a controller, such as dropdown lists, constant messages, or footer data.

#### Code Example: Populating the Model

Assume we have a list of departments required in both "create user" and "edit user" views.

```java
package com.example.web;

import org.springframework.web.bind.annotation.ModelAttribute;
import java.util.Arrays;
import java.util.List;

@Controller
@RequestMapping("/user")
public class UserController {

    // 1. This method runs BEFORE any other handler method (like showForm or saveUser).
    // The list is added to the Model under the key "departmentList".
    @ModelAttribute("departmentList")
    public List<String> populateDepartments() {
        System.out.println("Executing @ModelAttribute method: Populating departments.");
        return Arrays.asList("IT", "HR", "Finance", "Marketing");
    }

    @GetMapping("/register")
    public String showRegistrationForm() {
        // When this method returns, the Model already contains the "departmentList".
        return "registration-form";
    }
    
    // ... other handler methods also have access to "departmentList" ...
}
```

  * **Key:** The string argument `"departmentList"` specifies the key under which the data is stored in the Model. If omitted, the key defaults to the return type's name (e.g., `"list"`).

-----

### 2\. Form Data Binding (Method Parameter Level)

When applied to a method parameter, `@ModelAttribute` tells Spring to perform two actions:

1.  **Bind:** Map incoming form fields (request parameters) to the fields of the specified Java object.
2.  **Add to Model:** Add the bound object to the **`Model`** container.

This simplifies receiving complex form submissions into a single POJO.

#### Code Example: Binding Form Data

Assume the client submits a form with fields `username` and `email`.

**`src/main/java/com/example/model/User.java` (POJO)**

```java
public class User {
    private String username;
    private String email;
    // Getters and Setters are required for binding
}
```

**`src/main/java/com/example/web/UserController.java` (Handler Method)**

```java
@Controller
@RequestMapping("/user")
public class UserController {

    // The method handles the POST request from the form submission.
    @PostMapping("/save")
    public String saveUser(
        // 1. Spring creates a new User object.
        // 2. Spring finds form fields matching User properties (username, email)
        // 3. Spring sets those values on the newUser object.
        @ModelAttribute("user") User newUser) 
    {
        System.out.println("Form submitted for user: " + newUser.getUsername());
        // Logic to save newUser to the database
        return "redirect:/user/success";
    }
}
```

  * **Model Key:** The `"user"` argument specifies the name used to reference this object in both the Model and the View.

### 3\. Combining Form Display and Submission

The most common use case is a pair of methods: one to show the blank form (GET) and one to process the submission (POST). Both use `@ModelAttribute` with the same key.

#### Code Example: GET and POST Form Handling

```java
@Controller
@RequestMapping("/user")
public class UserController {

    // GET: Shows the form. Creates a blank User object and adds it to the Model 
    // under the key "user". The view uses this object to build the form inputs.
    @GetMapping("/form")
    public String showUserForm(Model model) {
        // Must add a blank object so the form template can bind to it
        model.addAttribute("user", new User()); 
        return "user-form"; 
    }

    // POST: Processes the form. Spring binds the submission data to the "user" object.
    @PostMapping("/form")
    public String processUserForm(@ModelAttribute("user") User submittedUser) {
        System.out.println("Processing user: " + submittedUser.getUsername());
        // ... save logic ...
        return "redirect:/user/success";
    }
}
```

  * **Crucial Point:** For the GET method, we explicitly add a blank `new User()` object to the Model. This is because the View (e.g., a Thymeleaf form) needs to access a `user` object to construct the input fields with correct binding paths.
