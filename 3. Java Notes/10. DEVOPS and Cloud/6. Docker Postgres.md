# ðŸš€ 10. DevOps and Cloud

## 06-dockerfile-postgres.md

### 1\. Using Official Database Images

Unlike application code, which you build using a custom Dockerfile, for databases like PostgreSQL, you should rely on the hardened, official images provided on **Docker Hub**. These images are regularly updated, secure, and come with well-documented configuration options.

### 2\. Configuration via Environment Variables

The official PostgreSQL image requires configuration parametersâ€”like the default password, username, and database nameâ€”to be passed during container startup using **Environment Variables** (the `-e` flag).

| Variable | Purpose |
| :--- | :--- |
| `POSTGRES_USER` | Sets the default database user (e.g., `appuser`). |
| `POSTGRES_PASSWORD` | Sets the password for the superuser/default user. **Mandatory**. |
| `POSTGRES_DB` | Creates a new database with the specified name upon initialization. |

### 3\. The Data Persistence Problem

The default behavior of a Docker container is that its filesystem is **ephemeral**. If you stop and then remove a database container (`docker rm`), all the data stored within it (your records, tables, etc.) is permanently **lost**.

To make database data durable, we must use **Docker Volumes**.

#### Solution: Docker Volumes

A **Volume** is a persistent storage mechanism that stores data on the host machine's filesystem, **outside** the container's file system. This decouples the data lifecycle from the container lifecycle.

  * **Named Volumes:** Docker manages the volume's location, making them the preferred choice for persistent database data.

### 4\. Running PostgreSQL with Persistence

To run a production-ready PostgreSQL container, you must use the `-v` flag to mount a volume to the internal directory where PostgreSQL stores its data (`/var/lib/postgresql/data`).

#### A. Create the Volume (Optional, but recommended)

Before running, you can explicitly create the volume:

```bash
docker volume create postgres_data
```

#### B. The Run Command

This single command sets up a database container that is network-accessible and durable.

```bash
docker run -d \
    -p 5432:5432 \
    --name postgres_db \
    -e POSTGRES_USER=appuser \
    -e POSTGRES_PASSWORD=mysecretpassword \
    -e POSTGRES_DB=job_app_db \
    -v postgres_data:/var/lib/postgresql/data \
    postgres:14
```

  * **`-p 5432:5432`**: Maps the host port 5432 (default PostgreSQL port) to the container port.
  * **`-v postgres_data:/var/lib/postgresql/data`**: **Persistence line.** It mounts the named volume `postgres_data` to the required internal data path of PostgreSQL. If you remove and recreate the container (`postgres_db`), it will reuse this volume and retain all its data.

This setup ensures that even if the container crashes or is replaced, the data remains safe on the host machine.
